var e=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;const t=[];for(let e=0;e<256;++e)t.push((e+256).toString(16).slice(1));let n;const r=new Uint8Array(16);var o={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function c(e,c,a){if(o.randomUUID&&!e)return o.randomUUID();const i=(e=e||{}).random??e.rng?.()??function(){if(!n){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");n=crypto.getRandomValues.bind(crypto)}return n(r)}();if(i.length<16)throw new Error("Random bytes length must be >= 16");return i[6]=15&i[6]|64,i[8]=63&i[8]|128,function(e,n=0){return(t[e[n+0]]+t[e[n+1]]+t[e[n+2]]+t[e[n+3]]+"-"+t[e[n+4]]+t[e[n+5]]+"-"+t[e[n+6]]+t[e[n+7]]+"-"+t[e[n+8]]+t[e[n+9]]+"-"+t[e[n+10]]+t[e[n+11]]+t[e[n+12]]+t[e[n+13]]+t[e[n+14]]+t[e[n+15]]).toLowerCase()}(i)}const a="visitorId";function i(t){return{getClientId:()=>{const n=t.get(),r=n.storage,o=r.getItem(a),c=o&&("string"==typeof(i=o)&&e.test(i))?o:n.generateUUID();var i;return r.setItem(a,c),c}}}const s="1.2.7";function u(e){return(e.source||[]).concat([`relay@${s}`])}function f(e,t,n,r){const{getReferrer:o,getLocation:c,getUserAgent:a}=n,i=function(e){const{trackingId:t}=e;return{trackingId:t}}(t),s=r.getClientId();return Object.freeze({type:e,config:i,ts:Date.now(),source:u(t),clientId:s,userAgent:a(),referrer:l(o()),location:l(c())})}function l(e){return null!==e?function(e,t){if(t<0||e.length<=t)return e;let n=e.indexOf("%",t-2);for(n<0||n>t?n=t:t=n;n>2&&"%"==e.charAt(n-3);){const o=Number.parseInt(e.substring(n-2,n),16);if(128&~o)break;if(n-=3,128!=(192&o)){t-n>=3*(240==(248&(r=o))?4:224==(240&r)?3:192==(224&r)?2:1)&&(n=t);break}}var r;return e.substring(0,n)}(e,1024):null}function g(){const e=[];function t({type:t,callback:n}){return e.findIndex((e=>e.type===t&&e.callback===n))}function n(n,r){r?function(n){const r=t(n);r>=0&&e.splice(r,1)}({type:n,callback:r}):function(t){if("*"===t)e.length=0;else for(let n=e.length-1;n>=0;n--)e[n].type===t&&e.splice(n,1)}(n)}return{add:function(r){return t(r)<0&&e.push(r),()=>n(r.type,r.callback)},call:function(t){e.forEach((e=>{if(function(e,t){return"*"===e.type||t===e.type}(e,t.meta.type))try{e.callback(t)}catch(e){console.error(e)}}))},remove:n}}function d({url:e,token:t,trackingId:n,...r}){return Object.freeze({url:e,token:t,trackingId:n,...!!r.mode&&{mode:r.mode},...!!r.source&&{source:r.source},...!!r.environment&&{environment:r.environment}})}const m=function(){const e="coveo_";return{getItem(t){const n=`${e}${t}=`,r=document.cookie.split(";");for(const e of r){const t=e.replace(/^\s+/,"");if(0===t.lastIndexOf(n,0))return t.substring(n.length,t.length)}return null},setItem(t,n,r){const o=(e=>{const t=e.split(".").slice(-2);return 2==t.length?t.join("."):""})(window.location.hostname),c=`;expires=${new Date((new Date).getTime()+r).toUTCString()}`,a=o?`;domain=${o}`:"";document.cookie=`${e}${t}=${n}${c}${a};path=/;SameSite=Lax`},removeItem(e){this.setItem(e,"",-1)}}}();function p(){return{runtime:"browser",send:(e,t,n)=>{const r=navigator.sendBeacon(`${e}?access_token=${t}`,new Blob([JSON.stringify([n])],{type:"application/json"})),o=function(){const e="undefined"!=typeof window;return{sendMessage(t){e&&window.postMessage(t,"*")}}}();if(o.sendMessage({kind:"EVENT_PROTOCOL",event:n,url:e,token:t}),!r)throw new Error("Failed to send the event(s) because the payload size exceeded the maximum allowed size (32 KB). Please contact support if the problem persists.")},getReferrer:()=>function(){const e=document.referrer;return""===e?null:e}(),getLocation:()=>window.location.href,getUserAgent:()=>navigator.userAgent,generateUUID:()=>c(),storage:{getItem:e=>m.getItem(e)||localStorage.getItem(e),removeItem(e){m.removeItem(e),localStorage.removeItem(e)},setItem(e,t){localStorage.setItem(e,t),m.setItem(e,t,31556952e3)}}}}function I(e){const t="disabled"!==e.get().mode,n=e.get().environment,r={runtime:"null",send:()=>{},getReferrer:()=>null,getLocation:()=>null,getUserAgent:()=>null,generateUUID:()=>"",storage:{getItem:()=>null,removeItem(){},setItem(){}}};return t&&n?{storage:r.storage,...n,runtime:"custom"}:t&&function(){try{return"object"==typeof window}catch{return!1}}()&&function(){try{const e="__storage_test__";return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return e instanceof DOMException&&"QuotaExceededError"===e.name&&localStorage&&0!==localStorage.length}}()?p():r}function y(e){const t=function(e){let t=d(e);return{get:()=>t,update:e=>{t=d({...t,...e})}}}(e),n=g(),r=function(e){return{get:()=>Object.freeze(I(e))}}(t),o=i(r);return{emit:(e,c)=>{const a=t.get(),i=r.get(),s=function(e,t,n,r,o){return{...t,meta:f(e,n,r,o)}}(e,c,a,i,o);return function({config:e,environment:t,event:n,listenerManager:r}){const{url:o,token:c,mode:a}=e;"disabled"!==a&&(r.call(n),t.send(o,c,n))}({config:a,environment:i,event:s,listenerManager:n})},getMeta:e=>f(e,t.get(),r.get(),o),on:(e,t)=>n.add({type:e,callback:t}),off:(e,t)=>n.remove(e,t),updateConfig:e=>t.update(e),version:s}}export{p as buildBrowserEnvironment,a as clientIdKey,y as createRelay};
//# sourceMappingURL=relay.min.js.map